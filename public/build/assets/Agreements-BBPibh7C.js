var N=Object.defineProperty;var w=(r,a,o)=>a in r?N(r,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):r[a]=o;var l=(r,a,o)=>(w(r,typeof a!="symbol"?a+"":a,o),o);import{j as e}from"./StatisticCard-Bdo2C3ON.js";import{r as i}from"./index-DFv2mRv-.js";import{c as C}from"./ReactAppend-CwiwA4iz.js";import{B as y}from"./Base-D2jNg5O4.js";import{C as S}from"./CreateReactScript-yWJ4gJYl.js";import{T as R,R as c}from"./ReactAppend-B_xoNf1Y.js";import{D as d}from"./DxButton-CsjWvhyj.js";import{B as x}from"./Content-DtiuTMAn.js";import{M as B}from"./Modal-B7I3CfuU.js";import{M as F}from"./Modal-C6W508ew.js";import{D as T}from"./Details-CN5R80WR.js";import{S as m}from"./sweetalert2.all-DCeKQPlA.js";import{r as k}from"./DxBox-PA__dqjs.js";import"./index-DgyC5pTR.js";import"./tippy-react.esm-BVvHiWwH.js";/* empty css              */import"./main-BBbUrZUL.js";import"./___vite-browser-external_commonjs-proxy-BQdpDcDf.js";import"./index.esm-B502ZfUP.js";/* empty css               */import"./InputFormGroup-z0D3_N8V.js";import"./SelectFormGroup-YFq90T3z.js";class D extends x{constructor(){super(...arguments);l(this,"path","coachee/agreements")}}class _ extends x{constructor(){super(...arguments);l(this,"path","coachee/observations")}}const A=(r,a="en-US")=>(Number(r)||0).toLocaleString(a,{maximumFractionDigits:2,minimumFractionDigits:2}),u=new D,M=new _,P=()=>{var p;const r=i.useRef(),a=i.useRef(),[o,b]=i.useState(null),[n,f]=i.useState(null),j=t=>{f(t),$(a.current).modal("show")},g=async()=>{$(a.current).modal("hide");const{value:t}=await m.fire({title:"Observar contrato",html:k(e.jsx("div",{style:{fontSize:"medium"},children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"observation-reason",style:{marginBottom:"4px"},children:"Motivo de la observación"}),e.jsx("textarea",{id:"observation-reason",className:"form-control",placeholder:"Ingrese el motivo de la observación aquí...",style:{minHeight:"27px",fieldSizing:"content"}})]})})),showCancelButton:!0,confirmButtonText:"Observar",cancelButtonText:"Cancelar",preConfirm:()=>{const h=$("#observation-reason").val();return h.trim()?h:(m.showValidationMessage("Por favor, ingrese el motivo de la observación"),!1)}});if(!t)return $(a.current).modal("show");await M.save({agreement_id:n==null?void 0:n.id,description:t})&&($(a.current).modal("hide"),$(r.current).dxDataGrid("instance").refresh())},v=async()=>{const{isConfirmed:t}=await m.fire({title:"Aceptar contrato",text:"¿Estas seguro de aceptar este contrato?",icon:"info",showCancelButton:!0,confirmButtonText:"Si, aceptar",cancelButtonText:"Cancelar"});!t||!await u.save({id:n.id,status:!0})||($(a.current).modal("hide"),$(r.current).dxDataGrid("instance").refresh())};return e.jsxs(e.Fragment,{children:[e.jsx(R,{gridRef:r,title:"Acuerdos",rest:u,toolBar:t=>{t.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(r.current).dxDataGrid("instance").refresh()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"coach.name",caption:"Coach",width:"250px",cellTemplate:(t,{data:s})=>{c(t,e.jsxs("a",{href:`/profile/${s.coach.uuid}`,className:"d-flex gap-2 align-items-center",target:"_blank",children:[e.jsx("div",{className:"inbox-item-img",children:e.jsx("img",{src:`/api/profile/thumbnail/${s.coach.relative_id}`,className:"rounded-circle avatar-sm",alt:""})}),e.jsxs("div",{children:[e.jsxs("h5",{className:"inbox-item-author mt-0 mb-0",children:[s.coach.name," ",s.coach.lastname]}),e.jsx("p",{className:"inbox-item-text mb-0",children:s.coach.email})]})]}))}},{dataField:"process_topic",caption:"Tema"},{dataField:"start_date",caption:"Fecha inicio",cellTemplate:(t,{data:s})=>{t.text(moment(s.start_date).format("LL"))}},{dataField:"payment_start_date",caption:"Fecha primera cuota",cellTemplate:(t,{data:s})=>{t.text(moment(s.payment_start_date).format("LL"))}},{dataField:"status",caption:"Estado",dataType:"boolean",cellTemplate:(t,{data:s})=>{switch(s.status){case 1:c(t,e.jsx("span",{className:"badge bg-success rounded-pill",children:"Aprobado"}));break;case 0:c(t,e.jsx("div",{children:e.jsxs("span",{className:"badge bg-danger rounded-pill",children:["Observado",e.jsx("i",{className:"mdi mdi-arrow-top-right ms-1"})]})}));break;default:c(t,e.jsx("span",{className:"badge bg-dark rounded-pill",children:"Pendiente"}));break}}},{caption:"Acciones",cellTemplate:(t,{data:s})=>{t.css("text-overflow","unset"),t.append(d({className:"btn btn-xs btn-soft-dark",title:"Ver acuerdo",icon:"fas fa-file-invoice",onClick:()=>j(s)})),t.append(d({className:"btn btn-xs btn-soft-success",title:"Ver pagos",icon:" fas fa-money-check-alt",onClick:()=>location.href=`/coachee/payments?agreement=${s.id}`})),t.append(d({className:"btn btn-xs btn-soft-primary",title:"Ver sesiones",icon:"fas fa-th-list",onClick:()=>location.href=`/coachee/sessions?agreement=${s.id}`}))},allowFiltering:!1,allowExporting:!1}]}),e.jsx(B,{dataLoaded:o,setDataLoaded:b,onSave:()=>$(r.current).dxDataGrid("instance").refresh()}),e.jsxs(F,{modalRef:a,title:`Acuerdo C${String(n==null?void 0:n.contract_number).padStart(3,"0")}`,size:"lg",hideButtonSubmit:!0,isStatic:!0,children:[e.jsx(T,{...n}),e.jsx("hr",{}),(n==null?void 0:n.status)==1?e.jsxs(e.Fragment,{children:[e.jsx("h4",{children:"Pagos del contrato:"}),e.jsxs("p",{children:["Para poder pagar las cuotas debes dirigirte a ",e.jsxs("a",{href:"/coachee/payments",children:["Pagos ",e.jsx("span",{className:"mdi mdi-arrow-top-right"})]})," en el menú."]}),e.jsxs("table",{className:"table table-sm table-striped",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("td",{children:"Monto"}),e.jsx("td",{children:"Fecha pago"}),e.jsx("td",{children:"Pagar antes de"}),e.jsx("td",{children:"Cargo"}),e.jsx("td",{children:"Estado"})]})}),e.jsx("tbody",{children:(p=n==null?void 0:n.payments)==null?void 0:p.map((t,s)=>e.jsxs("tr",{children:[e.jsxs("td",{children:["USD ",A(t.amount)]}),e.jsx("td",{children:t.payment_date}),e.jsx("td",{children:moment(t.due_date).format("LL")}),e.jsx("td",{}),e.jsx("td",{children:t.status?e.jsx("span",{className:"badge bg-success",children:"Pagado"}):e.jsx("span",{className:"badge bg-warning",children:"Pendiente"})})]},s))})]})]}):(n==null?void 0:n.status)==0?e.jsx("p",{className:"text-center text-danger",children:"Has observado el contrato, espere a que el coach lo corrija y se ponga en contacto contigo"}):e.jsxs("div",{className:"d-flex justify-content-center gap-2",children:[e.jsx("button",{className:"btn btn-sm btn-warning",type:"button",onClick:g,children:"Observar contrato"}),e.jsx("button",{className:"btn btn-sm btn-primary",type:"button",onClick:v,children:"Aceptar contrato"})]})]})]})};S((r,a)=>{C(r).render(e.jsx(y,{...a,title:"Acuerdos",children:e.jsx(P,{...a})}))});
