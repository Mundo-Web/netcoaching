var E=Object.defineProperty;var T=(o,t,s)=>t in o?E(o,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[t]=s;var j=(o,t,s)=>(T(o,typeof t!="symbol"?t+"":t,s),s);import{j as e}from"./StatisticCard-Bdo2C3ON.js";import{r as i}from"./index-DFv2mRv-.js";import{c as O}from"./ReactAppend-CwiwA4iz.js";import{C as P}from"./CreateReactScript-yWJ4gJYl.js";import{I as b}from"./InputFormGroup-B5shSbO3.js";import{i as C}from"./tippy-react.esm-BVvHiWwH.js";/* empty css              */import{m as h}from"./main-BBbUrZUL.js";import{B as U}from"./Base-D2jNg5O4.js";import"./index-DgyC5pTR.js";import"./index.esm-B502ZfUP.js";import"./___vite-browser-external_commonjs-proxy-BQdpDcDf.js";/* empty css               */class y{}j(y,"save",async t=>{try{const{status:s,result:a}=await h.Fetch("/api/profile",{method:"PATCH",body:JSON.stringify(t)});if(!s)throw new Error((a==null?void 0:a.message)||"Ocurrio un error inesperado");return h.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:a.message,type:"success"}),!0}catch(s){return h.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:s.message,type:"danger"}),!1}}),j(y,"saveProfile",async(t,s=!0)=>{try{const{full:a,thumbnail:l,type:c,ok:m}=await File.compress(t,{square:s});if(!m)throw new Error("Ocurrio un error al comprimir la imagen. Intenta con otra.");const u=new FormData;u.append("thumbnail",await File.fromURL(`data:${c};base64,${l}`)),u.append("full",await File.fromURL(`data:${c};base64,${a}`));const n=await fetch("/api/profile",{method:"POST",headers:{"X-Xsrf-Token":decodeURIComponent(h.Cookies.get("XSRF-TOKEN"))},body:u}),d=JSON.parseable(await n.text());if(!n.ok)throw new Error((d==null?void 0:d.message)??"Ocurrio un error inesperado");return h.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:"La imagen de perfil se actualizo correctamente",type:"success"}),d.data}catch(a){return h.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:a.message,type:"danger"}),!1}});const q=({col:o,label:t,eRef:s,required:a=!1,children:l,dropdownParent:c,multiple:m=!1,disabled:u=!1,onChange:n=()=>{},templateResult:d,templateSelection:v})=>(s||(s=i.useRef()),i.useEffect(()=>{$(s.current).select2({dropdownParent:c,templateResult:d,templateSelection:v}),$(s.current).on("change",n)},[c]),e.jsxs("div",{className:`form-group ${o} mb-2`,children:[e.jsxs("label",{htmlFor:"",children:[t," ",t&&a&&e.jsx("b",{className:"text-danger",children:"*"})]}),e.jsx("select",{ref:s,required:a,className:"form-control",style:{width:"100%"},disabled:u,multiple:m,children:l})]})),I=({col:o,label:t,eRef:s,placeholder:a,required:l=!1,rows:c=3,value:m})=>e.jsxs("div",{className:`form-group ${o} mb-2`,children:[e.jsxs("label",{htmlFor:"",children:[t," ",l&&e.jsx("b",{className:"text-danger",children:"*"})]}),e.jsx("textarea",{ref:s,className:"form-control",placeholder:a,required:l,rows:c,defaultValue:m,style:{minHeight:c*27,fieldSizing:"content"}})]}),D=({col:o,label:t,eRef:s,value:a,required:l=!1,rows:c=3,theme:m="snow",height:u="100px"})=>{const n=i.useRef();return i.useEffect(()=>{const d=new Quill(n.current,{theme:m,modules:{toolbar:[[{font:[]},{size:[]}],["bold","italic","underline","strike"],[{color:[]},{background:[]}],[{script:"super"},{script:"sub"}],[{header:[!1,1,2,3,4,5,6]},"blockquote","code-block"],[{list:"ordered"},{list:"bullet"},{indent:"-1"},{indent:"+1"}],["direction",{align:[]}],["link","image","video"],["clean"]]}});d.on("text-change",()=>{s.current.value=d.root.innerHTML}),s.editor=d,d.root.innerHTML=a??""},[null]),e.jsxs("div",{className:`form-group ${o} mb-2`,style:{height:"max-content"},children:[e.jsxs("label",{htmlFor:"",children:[t," ",l&&e.jsx("b",{className:"text-danger",children:"*"})]}),e.jsx("div",{ref:n,style:{height:u}}),e.jsx("input",{ref:s,type:"hidden",required:l,rows:c})]})};class L{constructor(){j(this,"saveCover",async t=>{try{const{full:s,thumbnail:a,type:l,ok:c}=await File.compress(t);if(!c)throw new Error("Ocurrio un error al comprimir la portada. Intenta con otra.");const m=new FormData;m.append("thumbnail",await File.fromURL(`data:${l};base64,${a}`)),m.append("full",await File.fromURL(`data:${l};base64,${s}`));const u=await fetch("/api/cover",{method:"POST",headers:{"X-Xsrf-Token":decodeURIComponent(h.Cookies.get("XSRF-TOKEN"))},body:m}),n=JSON.parseable(await u.text());if(!u.ok)throw new Error((n==null?void 0:n.message)??"Ocurrio un error inesperado");return h.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:"La imagen de portada se actualizo correctamente",type:"success"}),n.data}catch(s){return h.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:s.message,type:"danger"}),!1}})}}const z=new L,X=o=>{const{countries:t}=o,s=i.useRef(),a=i.useRef(),l=i.useRef(),c=i.useRef(),m=i.useRef(),u=i.useRef(),n=i.useRef(),d=i.useRef(),v=i.useRef(),R=i.useRef(),w=i.useRef(),[r,N]=i.useState(o.session),F=async x=>{x.preventDefault();const f={name:s.current.value,lastname:a.current.value,dni:l.current.value,phone:c.current.value,video:m.current.value,title:u.current.value,country:n.current.value,city:d.current.value,address:v.current.value,summary:R.current.value,description:w.current.value};if(!await y.save(f))return;const p=structuredClone(r);p.name=f.name,p.lastname=f.lastname,p.birthdate=f.birthdate,N(p)},S=async x=>{const f=x.target.files[0];if(!f)return;const g=await y.saveProfile(f,!1);if(!g)return;const p=structuredClone(r);p.uuid=g.uuid,N(p)},k=async x=>{const f=x.target.files[0];if(!f)return;const g=await z.saveCover(f);if(!g)return;const p=structuredClone(r);p.uuid=g.uuid,N(p)};return e.jsx(e.Fragment,{children:e.jsx("div",{className:"row justify-content-center align-items-center",style:{minHeight:"calc(100vh - 135px)"},children:e.jsx("div",{className:"col-xl-8 col-lg-9 col-md-10 col-sm-11 col-xs-12",children:e.jsxs("form",{className:"card",onSubmit:F,children:[e.jsx("div",{className:"card-header",children:e.jsx("h4",{className:"card-title mb-0",children:"Perfil"})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-sm-4 col-xs-12 position-relative",children:[e.jsx(C,{content:"Cambiar portada",arrow:!0,children:e.jsxs("label",{htmlFor:"cover",className:"ratio ratio-21x9",style:{cursor:"pointer"},children:[e.jsx("input",{className:"d-none",type:"file",name:"cover",id:"cover",accept:"image/*",onChange:k}),e.jsx("img",{src:`/api/cover/${r.uuid}?v=${crypto.randomUUID()}`,alt:`Perfil de ${r.name} ${r.lastname}`,style:{width:"100%",objectFit:"cover",objectPosition:"center",borderRadius:"4px"}})]})}),e.jsx(C,{content:"Cambiar foto de perfil",arrow:!0,children:e.jsxs("label",{htmlFor:"avatar",className:"rounded-circle mx-auto d-block position-relative",style:{cursor:"pointer",width:"max-content",marginTop:"-48px"},children:[e.jsx("input",{className:"d-none",type:"file",name:"avatar",id:"avatar",accept:"image/*",onChange:S}),e.jsx("img",{className:"avatar-xl rounded-circle bg-white",src:`/api/profile/${r.uuid}?v=${crypto.randomUUID()}`,alt:`Perfil de ${r.name} ${r.lastname}`,style:{objectFit:"cover",objectPosition:"center"}})]})}),e.jsxs("ul",{className:"social-list list-inline mt-3 mb-0",children:[e.jsx("li",{className:"list-inline-item",children:e.jsx("a",{href:"#",className:"social-list-item border-purple text-purple",children:e.jsx("i",{className:"fab fa-facebook-f"})})}),e.jsx("li",{className:"list-inline-item",children:e.jsx("a",{href:"#",className:"social-list-item border-danger text-danger",children:e.jsx("i",{className:"mdi mdi-google"})})}),e.jsx("li",{className:"list-inline-item",children:e.jsx("a",{href:"#",className:"social-list-item border-info text-info",children:e.jsx("i",{className:"mdi mdi-twitter"})})}),e.jsx("li",{className:"list-inline-item",children:e.jsx("a",{href:"#",className:"social-list-item border-secondary text-secondary",children:e.jsx("i",{className:"mdi mdi-github"})})})]})]}),e.jsxs("div",{className:"col-sm-8 col-xs-12",children:[e.jsxs("div",{className:"row",children:[e.jsx(b,{eRef:s,label:"Nombres",value:r.name,required:!0,col:"col-md-6 col-sm-12"}),e.jsx(b,{eRef:a,label:"Apellidos",value:r.lastname,required:!0,col:"col-md-6 col-sm-12"}),e.jsx(b,{eRef:l,label:"DNI",value:r.dni,required:!0,col:"col-md-6 col-sm-12"}),e.jsx(b,{eRef:c,label:"Telefono",value:r.phone,col:"col-md-6 col-sm-12"}),e.jsx(b,{eRef:m,label:"Video de YouTube",value:`https://youtu.be/${r.video}`}),e.jsx(b,{eRef:u,label:"Titulo",value:r.title,col:"col-md-6 col-sm-12",required:!0}),e.jsx(q,{eRef:n,label:"Pais",value:r.country,col:"col-md-6 col-sm-12",required:!0,children:t.map((x,f)=>e.jsx("option",{value:x.id,selected:x.id==r.country,children:x.name},`country-${f}`))}),e.jsx(b,{eRef:d,label:"Ciudad",value:r.city,col:"col-md-6 col-sm-12",required:!0}),e.jsx(b,{eRef:v,label:"Direccion",value:r.address,col:"col-md-6 col-sm-12"}),e.jsx(I,{eRef:R,label:"Resumen",col:"col-12",value:r.summary}),e.jsx(D,{eRef:w,label:"Descripcion",col:"col-12",value:r.description,height:"240px",required:!0})]}),e.jsx("div",{className:"text-center",children:e.jsxs("button",{className:"btn btn-primary btn-block",type:"submit",children:[e.jsx("i",{className:"fa fa-save"})," Actualizar"]})}),e.jsx("hr",{className:"mt-3 mb-2"}),e.jsx("p",{className:"card-text text-center",children:e.jsxs("small",{className:"text-muted",children:["Ultima actualizacion ",moment(r.updated_at).fromNow()]})})]})]})})]})})})})};P((o,t)=>{O(o).render(e.jsx(U,{...t,title:"Perfil de usuario",children:e.jsx(X,{...t})}))});
